<!-- Componente de Conex√£o da Carteira - wallet-connection -->
<div class="card bg-dark border-warning shadow mb-4">
    <div class="card-header bg-warning text-dark">
        <h5 class="card-title mb-0">
            <i class="bi bi-shield-check me-2"></i>Conex√£o Segura MetaMask
        </h5>
    </div>
    <div class="card-body">
        <div class="row g-3 align-items-end">
            <div class="col-md-8">
                <label for="wallet-status" class="form-label text-white">Status da Conex√£o</label>
                <input type="text" class="form-control bg-dark text-white border-secondary" id="wallet-status"
                    placeholder="Clique em 'Conectar' para iniciar" style="font-family: monospace;" readonly>
            </div>
            <div class="col-md-4">
                <button id="connect-metamask-btn" type="button" class="btn btn-warning w-100 fw-bold">
                    <i class="bi bi-wallet2 me-2"></i>CONECTAR
                </button>
            </div>
        </div>
        <div class="row mt-3" id="network-info-section" style="display: none;">
            <div class="col-12">
                <div class="alert alert-info mb-0">
                    <i class="bi bi-wifi me-2"></i>
                    <strong>Rede:</strong> <span id="current-network" class="fw-bold">-</span>
                    <span class="ms-3">
                        <i class="bi bi-link-45deg me-1"></i>
                        <strong>Chain ID:</strong> <span id="chain-id-value" class="fw-bold">-</span>
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Status de carregamento inicial -->
        <div id="wallet-loading" class="text-center mt-3" style="display: none;">
            <div class="spinner-border spinner-border-sm text-primary me-2" role="status"></div>
            <small class="text-muted">Verificando conex√£o existente...</small>
        </div>
    </div>
</div>

<script>
/**
 * Inicializa√ß√£o do Componente wallet-connection
 * Integra com o UniversalWallet system
 */
(function() {
    console.log('üîå Componente wallet-connection inicializando...');
    
    // Fun√ß√£o para inicializar quando UniversalWallet estiver pronto
    function initializeWalletComponent() {
        if (typeof UniversalWallet === 'undefined') {
            console.log('‚è≥ Aguardando UniversalWallet...');
            setTimeout(initializeWalletComponent, 100);
            return;
        }
        
        console.log('‚úÖ UniversalWallet detectado - verificando conex√£o existente...');
        
        // Mostrar loading enquanto verifica conex√£o
        const loadingDiv = document.getElementById('wallet-loading');
        if (loadingDiv) {
            loadingDiv.style.display = 'block';
        }
        
        // Verificar conex√£o existente IMEDIATAMENTE
        setTimeout(() => {
            // Verificar se MetaMask est√° conectado
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.request({ method: 'eth_accounts' })
                    .then(accounts => {
                        if (accounts.length > 0) {
                            console.log('üîó Conex√£o MetaMask detectada, inicializando...');
                            
                            // For√ßar inicializa√ß√£o do UniversalWallet
                            UniversalWallet.checkExistingConnection()
                                .then(connected => {
                                    if (connected) {
                                        console.log('‚úÖ Wallet reconectada automaticamente');
                                    }
                                    finalizarInicializacao();
                                });
                        } else {
                            console.log('üîå Nenhuma conex√£o MetaMask - bot√£o conectar dispon√≠vel');
                            finalizarInicializacao();
                        }
                    })
                    .catch(error => {
                        console.log('‚ö†Ô∏è Erro ao verificar contas:', error);
                        finalizarInicializacao();
                    });
            } else {
                console.log('‚ùå MetaMask n√£o detectado');
                finalizarInicializacao();
            }
        }, 300);
        
        function finalizarInicializacao() {
            // Ocultar loading
            if (loadingDiv) {
                loadingDiv.style.display = 'none';
            }
            
            // Garantir que os event listeners est√£o configurados
            UniversalWallet.setupEventListeners();
            
            console.log('‚úÖ Componente wallet-connection inicializado');
        }
    }
    
    // Callback para quando wallet for conectada
    window.onWalletConnected = function(data) {
        console.log('üéØ Callback: Wallet conectada no componente', data.address);
        
        // Atualizar progresso visual se existir
        if (typeof updateVisualProgress === 'function') {
            updateVisualProgress();
        }
        
        // Notificar outras partes da aplica√ß√£o
        if (typeof window.onWalletConnectionChange === 'function') {
            window.onWalletConnectionChange(true, data);
        }
    };
    
    // Callback para quando wallet for desconectada
    window.onWalletDisconnected = function() {
        console.log('üîå Callback: Wallet desconectada no componente');
        
        // Atualizar progresso visual se existir
        if (typeof updateVisualProgress === 'function') {
            updateVisualProgress();
        }
        
        // Notificar outras partes da aplica√ß√£o
        if (typeof window.onWalletConnectionChange === 'function') {
            window.onWalletConnectionChange(false, null);
        }
    };
    
    // Inicializar quando DOM estiver pronto
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeWalletComponent);
    } else {
        initializeWalletComponent();
    }
})();
</script>